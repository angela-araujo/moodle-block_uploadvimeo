{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template block_uploadvimeo/form

    This template renders the form content area for the upload vimeo block.

    Example context (json):
    {
        "attributes": [                                                                                                             
            { "name": "heading", "value": "Meus vídeos" },
            { "name": "url", "value": "" },
            { "name": "returnlink", "value": "" },
            { "name": "returntext", "value": "Click here to back course" },
            { "name": "", "value": "" },
        ]
    }
}}
    <link rel="stylesheet" href="style.css">


    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<!--
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
-->
    <script src="https://cdn.jsdelivr.net/npm/tus-js-client@1.8.0/dist/tus.min.js"></script>    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

    <script src="js/util.js?121213141415"></script>
    <script src="js/config.js?121213141415"></script>    
    <script src="js/vimeo-api.js?121213141415"></script>
    <script src="js/app.js?121213141415"></script>        

<style>

</style>

<div id="block-uploadvimeo-{{uniqid}}" class="block-uploadvimeo block-cards" data-region="uploadvimeo" role="navigation">
	<div class="card">
		<div class="card-body">	
			<h2 class="card-title">Enviar vídeos para a plataforma Vimeo</h2>
			<br><br>
			<div class="draggable" id="register" style="max-width:80%;">        
				<p class="lead">Para enviar um vídeo, arraste-o para dentro desta área demarcada, ou clique no botão <strong>Enviar vídeo</strong>.</p>
				<br><br>
				<div>
					<label class="btn btn-primary">
					  Enviar Vídeo <input id="browse" type="file" style="display: none;">
					</label>
				</div>
			</div>
			
			<div id="success_alert" class="alert alert-success" role="alert" style="display: none;">
				<div class="mt-3, mb-3">
					<br>
					<h4>Vídeo enviado com sucesso!</h4>
					<br>
					<h4>Verifique abaixo os códigos de incorporação para adicionar no seu conteúdo.</h4>
				</div>
				<pre>          
				</pre>
			</div>
  		
		
		</div>
	</div>

	<br>
		
	<!-- ************************************************************************************************************************************** -->
	<div class="card">
		<div class="card-body">		
			<h3>Meus vídeos</h3>
			<br><br>
			<h5>{{{ textmyvideos }}}</h5>	
			<ul>
				{{# myvideos }}
				<li>
					<img src="{{ thumbnail }}" class="rounded">				
					<a class="btn btn-link" data-toggle="collapse" aria-expanded="false" aria-controls="videoid_{{ videoid }}" data-target="#videoid_{{ videoid }}">
					{{ name }}
					<i class="icon fa fa-file-code-o fa-fw " style="color:gray"></i>					
					</a>
				</li>
				<div class="collapse" id="videoid_{{ videoid }}">
					<textarea class="codeembed rounded" readonly>{{ htmlembed }}</textarea>
				</div>
				{{/ myvideos }}
			</ul>
		</div>	
	</div><!-- end card my videos -->

</div>

    <script> $( document ).ready(function() {

      //http://hayageek.com/drag-and-drop-file-upload-jquery/
      var obj = $(".draggable");
      obj.on('dragenter', function (e) 
      {
          e.stopPropagation();
          e.preventDefault();
      });
      obj.on('dragover', function (e) 
      {
          e.stopPropagation();
          e.preventDefault();
          $(this).css('border', '4px dotted #0B85A1');
      });
      obj.on('dragleave', function (e) 
      {
          $(this).css('border', '');
      });
  
      
      obj.on('drop', handleFileSelect);     

      $('input[type="file"]').change(handleFileSelect); 


      //prevent open file
      $(document).on('dragenter', function (e) 
      {
          e.stopPropagation();
          e.preventDefault();
      });
      $(document).on('dragover', function (e) 
      {
        e.stopPropagation();
        e.preventDefault();
      });
      $(document).on('drop', function (e) 
      {
          e.stopPropagation();
          e.preventDefault();
      });

      var browse = document.getElementById('browse')

      function handleFileSelect(evt) {
            evt.stopPropagation()
            evt.preventDefault()
            
            $("#success_alert").hide();

            $(this).css('border', '');

            let files = (evt.originalEvent && evt.originalEvent.dataTransfer)?  evt.originalEvent.dataTransfer.files : $(this).get(0).files
            
            MY_APP.sendFile( files );
      }      

    });</script>